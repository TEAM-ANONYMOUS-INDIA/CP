<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visitor Details - TEAM ANONYMOUS INDIA</title>
    <style>
        body { 
            text-align: center; font-family: 'Poppins', sans-serif;
            background: linear-gradient(45deg, #121212, #1b1b1b); 
            color: #fff; padding: 50px;
        }
        h1 { color: #00bcd4; font-size: 2rem; text-shadow: 0px 0px 10px #00bcd4; }
        .hidden { display: none; }

        /* Stylish Login Form */
        .login-container {
            background: rgba(0, 0, 0, 0.8); padding: 20px; 
            border-radius: 10px; width: 320px; margin: 0 auto; 
            box-shadow: 0px 0px 10px #00bcd4;
        }
        input, button {
            padding: 12px; margin: 10px; width: 90%; font-size: 16px; 
            color: white; background-color: #222; border: 1px solid #00bcd4; 
            border-radius: 8px; transition: 0.3s;
        }
        input::placeholder { color: #bbb; }
        button { background-color: #00bcd4; cursor: pointer; }
        button:hover { background-color: #0097a7; box-shadow: 0px 0px 10px #00bcd4; }

        /* Visitor Table */
        table { 
            width: 80%; margin: 20px auto; border-collapse: collapse;
            background: rgba(0, 0, 0, 0.8); color: #fff; 
            box-shadow: 0px 0px 15px rgba(0, 188, 212, 0.7);
        }
        th, td { padding: 15px; border: 1px solid #00bcd4; text-align: center; }
        th { background: #00bcd4; color: #121212; }
        .online { color: #0f0; font-weight: bold; }
        .offline { color: #f00; font-weight: bold; }
        .last-seen { font-size: 0.9em; color: #aaa; }
    </style>
</head>
<body>

    <!-- Stylish Login Form -->
    <div id="loginSection" class="login-container">
        <h2>üîí Secure Login</h2>
        <input type="text" id="username" placeholder="Enter Username">
        <input type="password" id="password" placeholder="Enter Password">
        <button onclick="login()">Login üöÄ</button>
        <p id="errorMsg" style="color: red;"></p>
    </div>

    <!-- Visitor Details Section (Hidden Until Login) -->
    <div id="detailsSection" class="hidden">
        <h1>üñ•Ô∏è Visitor Details</h1>
        <p id="welcomeMessage">Welcome, Loading IP...</p>

        <table>
            <thead>
                <tr>
                    <th>IP Address</th>
                    <th>Last Visited Page</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="ip-list">
                <tr><td colspan="3">Loading...</td></tr>
            </tbody>
        </table>

        <button onclick="logout()">üîë Logout</button>
    </div>

    <script>
        // Plaintext Password Login
        const correctUsername = "Root-User";
        const correctPassword = "TAI-SECURE";

        // Secure Login Function
        function login() {
            let username = document.getElementById("username").value;
            let password = document.getElementById("password").value;
            let errorMsg = document.getElementById("errorMsg");

            if (username === correctUsername && password === correctPassword) {
                localStorage.setItem("loggedIn", "true");  // Session-based login
                document.getElementById("loginSection").style.display = "none";
                document.getElementById("detailsSection").style.display = "block";
                logVisitor();
            } else {
                errorMsg.innerText = "‚ö†Ô∏è Incorrect Username or Password!";
            }
        }

        // Enforce Login Every Time (Persistent with LocalStorage)
        if (localStorage.getItem("loggedIn") === "true") {
            document.getElementById("loginSection").style.display = "none";
            document.getElementById("detailsSection").style.display = "block";
            logVisitor();
        } else {
            document.getElementById("loginSection").style.display = "block";
            document.getElementById("detailsSection").style.display = "none";
        }

        // Logout Function
        function logout() {
            localStorage.removeItem("loggedIn");
            location.reload();
        }

        // Function to Log Visitor's IP
        async function logVisitor() {
            let response = await fetch('https://api.ipify.org?format=json');
            let data = await response.json();
            let ip = data.ip;
            let page = window.location.pathname;

            let visitors = JSON.parse(localStorage.getItem("visitorData")) || {};
            visitors[ip] = { ip: ip, page: page, last_seen: Date.now() };
            localStorage.setItem("visitorData", JSON.stringify(visitors));

            document.getElementById("welcomeMessage").innerHTML = `Welcome, ${ip} üëã`;
        }

        // Function to Convert Timestamp to Readable Format
        function formatTimestamp(timestamp) {
            let date = new Date(timestamp);
            return date.toLocaleString();
        }

        // Function to Display Visitors
        function displayVisitorData() {
            let visitors = JSON.parse(localStorage.getItem("visitorData")) || {};
            let tbody = document.getElementById("ip-list");
            tbody.innerHTML = "";

            let now = Date.now();
            Object.values(visitors).forEach(visitor => {
                let isOnline = (now - visitor.last_seen < 300000);
                let status = isOnline 
                    ? '<span class="online">üü¢ Online</span>' 
                    : `<span class="offline">üî¥ Offline</span><br><span class="last-seen">Last seen: ${formatTimestamp(visitor.last_seen)}</span>`;

                tbody.innerHTML += `
                    <tr>
                        <td>${visitor.ip}</td>
                        <td>${visitor.page}</td>
                        <td>${status}</td>
                    </tr>`;
            });
        }

        setInterval(displayVisitorData, 10000);
        displayVisitorData();
    </script>

</body>
</html>